# Руководство Пользователя - Модуль "Платежи" (Payments)

## Содержание
1. [Обзор модуля](#обзор-модуля)
2. [Просмотр списка платежей](#просмотр-списка-платежей)
3. [Фильтрация платежей](#фильтрация-платежей)
4. [Просмотр деталей платежа](#просмотр-деталей-платежа)
5. [Создание нового платежа](#создание-нового-платежа)
6. [Редактирование платежа](#редактирование-платежа)
7. [Статусы платежей](#статусы-платежей)
8. [Методы оплаты](#методы-оплаты)
9. [Часто задаваемые вопросы (FAQ)](#часто-задаваемые-вопросы-faq)

---

## Обзор модуля

Модуль "Платежи" предназначен для управления всеми платежными транзакциями, связанными с арендой автомобилей. Он позволяет:
- Просматривать все платежи в системе
- Фильтровать платежи по различным критериям
- Записывать новые платежи от клиентов
- Редактировать статусы и детали платежей
- Отслеживать баланс платежей по каждой аренде
- Получать статистику по платежам

### Доступ к модулю
- Главное меню ? **"Payments"**
- Dashboard ? Quick Actions ? **"View Payments"**
- URL: `/Payments`

---

## Просмотр списка платежей

### Как открыть список платежей
1. В главном меню нажмите на **"Payments"**
2. Откроется страница со списком всех платежей

### Что вы увидите

#### Статистические карточки (вверху страницы)
- **Total Completed** - общая сумма завершенных платежей
- **Pending Payments** - количество ожидающих платежей
- **Failed Payments** - количество неудачных платежей
- **Total Transactions** - общее количество всех транзакций

#### Таблица платежей
Каждая строка содержит:
- **Payment ID** - уникальный номер платежа
- **Rental ID** - номер связанной аренды (кликабельный)
- **Client** - имя клиента
- **Vehicle** - марка и модель автомобиля + регистрационный номер
- **Payment Date** - дата платежа
- **Amount** - сумма платежа (зеленым цветом)
- **Method** - метод оплаты (с иконкой)
- **Status** - статус платежа (цветной бейдж)
- **Actions** - кнопки действий (??? Просмотр, ?? Редактирование)

---

## Фильтрация платежей

### Доступные фильтры

#### 1. По ID аренды (Rental ID)
- Введите номер аренды для отображения всех платежей по этой аренде
- Полезно для проверки всех оплат конкретной аренды

#### 2. По статусу платежа (Payment Status)
- **All Statuses** - показать все
- **Completed** - только завершенные платежи
- **Pending** - только ожидающие подтверждения
- **Failed** - только неудачные попытки оплаты
- **Refunded** - только возвращенные платежи

#### 3. По методу оплаты (Payment Method)
- **All Methods** - показать все
- **CreditCard** - только оплаты картой
- **Cash** - только наличные
- **BankTransfer** - только банковские переводы
- **BLIK** - только BLIK платежи

#### 4. По диапазону дат
- **From Date** - начальная дата периода
- **To Date** - конечная дата периода

### Как использовать фильтры

1. Выберите нужные критерии фильтрации в панели "Filter Payments"
2. Нажмите кнопку **"Filter"** (??)
3. Система отобразит только платежи, соответствующие критериям
4. Для сброса фильтров нажмите **"Clear Filters"** (??)

### Советы по фильтрации
- Можно комбинировать несколько фильтров одновременно
- Фильтры применяются мгновенно после нажатия "Filter"
- Состояние фильтров сохраняется при навигации

---

## Просмотр деталей платежа

### Как открыть детали
1. В списке платежей найдите нужный платеж
2. Нажмите на кнопку **???** (View Details) в колонке "Actions"
3. Откроется страница с полной информацией о платеже

### Что отображается на странице

#### Левая панель: Информация о платеже
- **Большая визуальная карточка** с суммой платежа
- **Payment ID** - номер платежа
- **Payment Date** - дата совершения платежа
- **Payment Method** - способ оплаты (с иконкой)
- **Payment Status** - текущий статус (с цветовым индикатором)

#### Правая панель: Информация о связанной аренде
- **Rental ID** - номер аренды (с кнопкой перехода)
- **Client** - имя клиента (кликабельная ссылка)
- **Vehicle** - марка, модель и регистрационный номер
- **Daily Rate** - дневная ставка аренды
- **Rental Period** - даты начала и возврата + продолжительность
- **Rental Status** - текущий статус аренды
- **Processed By** - сотрудник, обработавший аренду

#### Нижняя панель: Сводка платежей по аренде
- **Total Cost** - общая стоимость аренды (дни ? ставка)
- **Total Paid** - общая сумма всех завершенных платежей
- **Remaining Balance** - оставшаяся сумма к оплате
- **Paid Percentage** - процент оплаченной суммы

### Доступные действия
- **Back to List** - вернуться к списку платежей
- **Edit Payment** - изменить детали платежа
- **View Rental** - перейти к деталям связанной аренды

---

## Создание нового платежа

### Способы создания платежа

#### Способ 1: Из списка платежей
1. Откройте страницу Payments
2. Нажмите **"Record New Payment"** (?)
3. Выберите аренду из выпадающего списка

#### Способ 2: Из деталей аренды
1. Откройте детали нужной аренды
2. Нажмите кнопку **"Add Payment"**
3. Аренда будет выбрана автоматически

### Заполнение формы создания платежа

#### 1. Выбор или подтверждение аренды
- Если пришли из аренды - ID отображается автоматически
- Если пришли из списка - выберите аренду из списка
- При выборе аренды автоматически загружается информация о ней

#### 2. Дата платежа (Payment Date)
- По умолчанию установлена текущая дата
- Можно изменить на любую другую дату
- Обязательное поле

#### 3. Сумма платежа (Payment Amount)
- Введите сумму в поле с символом валюты ($)
- Должна быть больше 0
- **Автоматическая подсказка**: система предложит оставшуюся сумму к оплате
- Поддерживаются частичные платежи

#### 4. Метод оплаты (Payment Method)
Выберите один из вариантов:
- **CreditCard** (??) - Оплата банковской картой
- **Cash** (??) - Оплата наличными
- **BankTransfer** (??) - Банковский перевод
- **BLIK** (??) - Мобильные платежи BLIK

#### 5. Статус платежа (Payment Status)
Выберите подходящий статус:
- **Completed** (?) - Платеж успешно завершен
- **Pending** (??) - Ожидает подтверждения
- **Failed** (?) - Платеж не прошел
- **Refunded** (?) - Платеж возвращен

### Панель информации об аренде (справа)

При выборе аренды автоматически отображается:
- Имя клиента
- Информация об автомобиле
- Дневная ставка
- Период аренды
- **Общая стоимость аренды**
- **Уже оплаченная сумма**
- **Оставшийся баланс** (красным, если есть долг)

### Советы по созданию платежа

**Панель "Payment Tips"** содержит:
- Проверяйте информацию об аренде перед записью
- Сверяйте оставшийся баланс, чтобы избежать переплаты
- Используйте статус "Completed" для подтвержденных платежей
- Используйте "Pending" для неподтвержденных транзакций
- Частичные платежи разрешены
- Указывайте фактическую дату платежа

### Сохранение платежа
1. Заполните все обязательные поля
2. Проверьте введенные данные
3. Нажмите **"Record Payment"** (??)
4. Система перенаправит вас к деталям созданного платежа
5. Появится сообщение об успешном создании

### Отмена создания
- Нажмите кнопку **"Cancel"** для возврата без сохранения

---

## Редактирование платежа

### Когда нужно редактировать платеж
- Изменить статус платежа (например, с Pending на Completed)
- Исправить сумму платежа
- Изменить метод оплаты
- Скорректировать дату платежа

### Как редактировать

1. Откройте детали платежа
2. Нажмите **"Edit Payment"** (??)
3. Откроется форма редактирования

### Что можно изменить

#### Редактируемые поля:
- ? **Payment Date** - дата платежа
- ? **Amount** - сумма платежа
- ? **Payment Method** - метод оплаты
- ? **Payment Status** - статус платежа

#### Нередактируемые поля:
- ? **Payment ID** - идентификатор (только для чтения)
- ? **Rental ID** - связанная аренда (только для чтения)

### Панель "Important Notes"

При редактировании обратите внимание:
- **Status Changes** - обновляйте статус согласно фактическому состоянию
- **Completed** - платеж успешно получен
- **Pending** - платеж ожидает подтверждения
- **Failed** - транзакция не прошла
- **Refunded** - платеж возвращен клиенту
- **Amount** - будьте осторожны при изменении суммы
- **Date** - убедитесь в правильности даты

### Сохранение изменений
1. Внесите необходимые изменения
2. Проверьте данные
3. Нажмите **"Save Changes"** (??)
4. Система перенаправит к обновленным деталям платежа
5. Появится сообщение об успешном обновлении

### Отмена редактирования
- Нажмите **"Cancel"** для возврата без сохранения

---

## Статусы платежей

### ?? Completed (Завершен)
- **Значение**: Платеж успешно получен и обработан
- **Когда использовать**: После подтверждения получения средств
- **Цвет**: Зеленый
- **Влияние**: Включается в расчет оплаченной суммы

### ?? Pending (Ожидает)
- **Значение**: Платеж инициирован, но не подтвержден
- **Когда использовать**: Ожидание подтверждения банка/системы
- **Цвет**: Желтый
- **Влияние**: Не включается в расчет оплаченной суммы

### ?? Failed (Неудачный)
- **Значение**: Попытка оплаты не удалась
- **Когда использовать**: Транзакция отклонена или не прошла
- **Цвет**: Красный
- **Влияние**: Не включается в расчет оплаченной суммы

### ? Refunded (Возвращен)
- **Значение**: Платеж был возвращен клиенту
- **Когда использовать**: При возврате средств (отмена, переплата)
- **Цвет**: Серый
- **Влияние**: Вычитается из оплаченной суммы

---

## Методы оплаты

### ?? CreditCard (Банковская карта)
- Оплата дебетовой или кредитной картой
- Самый распространенный метод
- Мгновенное подтверждение

### ?? Cash (Наличные)
- Оплата наличными деньгами
- Требует подтверждения получения от сотрудника
- Используется при личном визите

### ?? BankTransfer (Банковский перевод)
- Перевод со счета на счет
- Может требовать времени на обработку
- Используется для крупных сумм

### ?? BLIK (Мобильные платежи)
- Польская система мобильных платежей
- Быстрые и удобные платежи
- Популярен в Польше

---

## Часто задаваемые вопросы (FAQ)

### Общие вопросы

**Q: Можно ли удалить платеж?**
A: В текущей версии удаление платежей не предусмотрено. Вместо этого измените статус на "Failed" или "Refunded" в зависимости от ситуации.

**Q: Можно ли создать несколько платежей для одной аренды?**
A: Да, система поддерживает частичные платежи. Вы можете создавать несколько платежей для одной аренды, пока не будет оплачена полная сумма.

**Q: Как увидеть все платежи конкретного клиента?**
A: Перейдите к деталям клиента (Clients ? Details), там отображается история всех его аренд и платежей.

**Q: Что произойдет, если сумма платежей превысит стоимость аренды?**
A: Система позволяет это, но покажет отрицательный оставшийся баланс. В таком случае следует создать возвратный платеж со статусом "Refunded".

### Вопросы о создании платежей

**Q: Какой статус выбрать при создании платежа?**
A: 
- Если оплата уже подтверждена - **Completed**
- Если ожидаете подтверждение - **Pending**
- Обычно рекомендуется начинать с **Pending** и менять на **Completed** после подтверждения

**Q: Можно ли указать дату платежа в прошлом?**
A: Да, вы можете указать любую дату. Это полезно при вводе исторических данных.

**Q: Автоматически ли рассчитывается оставшаяся сумма?**
A: Да, при выборе аренды система автоматически покажет оставшийся баланс и предложит его в качестве суммы платежа.

### Вопросы о фильтрации

**Q: Можно ли экспортировать отфильтрованный список платежей?**
A: В текущей версии функция экспорта не реализована, но планируется в будущих обновлениях.

**Q: Сохраняются ли фильтры при переходе между страницами?**
A: Нет, фильтры сбрасываются при переходе на другие страницы. Рекомендуется записывать нужные фильтры.

### Вопросы о статусах

**Q: Как изменить статус с Pending на Completed?**
A: Откройте детали платежа ? Edit Payment ? измените Status на Completed ? Save Changes.

**Q: Что делать, если платеж не прошел?**
A: Измените статус платежа на "Failed" и создайте новый платеж для повторной попытки оплаты.

**Q: Как оформить возврат денег?**
A: Создайте новый платеж с отрицательной суммой или измените существующий платеж на статус "Refunded".

### Технические вопросы

**Q: Почему не загружается информация об аренде при создании платежа?**
A: Убедитесь, что:
- У вас стабильное интернет-соединение
- Выбрана существующая аренда
- Аренда имеет статус Active или Reserved

**Q: Что означает "Remaining Balance" в деталях?**
A: Это разница между общей стоимостью аренды и суммой всех завершенных платежей. Положительное значение означает долг, отрицательное - переплату.

**Q: Включаются ли платежи со статусом Pending в расчет баланса?**
A: Нет, в расчет включаются только платежи со статусом **Completed**.

---

## Советы и лучшие практики

### При создании платежей:
1. ? Всегда проверяйте информацию об аренде перед записью
2. ? Используйте автоматически рассчитанную сумму для полной оплаты
3. ? Указывайте реальную дату платежа для точной отчетности
4. ? Выбирайте правильный метод оплаты
5. ? Начинайте со статуса Pending, если платеж не подтвержден

### При редактировании платежей:
1. ? Обновляйте статус своевременно
2. ? Документируйте причины изменений (в комментариях, если есть)
3. ? Будьте осторожны с изменением суммы
4. ? Проверяйте влияние на общий баланс аренды

### При работе с частичными платежами:
1. ? Планируйте график платежей с клиентом
2. ? Отслеживайте оставшийся баланс
3. ? Создавайте платежи последовательно
4. ? Используйте понятные методы оплаты

---

## Контакты и поддержка

При возникновении проблем или вопросов:
- Обратитесь к системному администратору
- Проконсультируйтесь с менеджером
- Изучите документацию разработчика (STEP7_PAYMENTS_MODULE_README.md)

---

**Версия документа**: 1.0  
**Дата**: Январь 2026  
**Модуль**: Payments Management System
