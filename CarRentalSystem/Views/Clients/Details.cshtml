@model CarRentalSystem.Entities.Users.Client

@{
    ViewData["Title"] = "Client Details";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold mb-0">
                <i class="fas fa-user text-primary"></i> Client Profile
            </h1>
            <p class="text-muted">Detailed information and rental history</p>
        </div>
    </div>

    <!-- Back Button -->
    <div class="mb-3">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
            <i class="fas fa-edit"></i> Edit Client
        </a>
        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">
            <i class="fas fa-trash"></i> Delete Client
        </a>
    </div>

    <div class="row">
        <!-- Client Information Card -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-id-card"></i> Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 100px; height: 100px; font-size: 3rem;">
                            <i class="fas fa-user"></i>
                        </div>
                        <h4 class="mt-3 mb-1">@Model.FirstName @Model.LastName</h4>
                        <p class="text-muted">Client ID: #@Model.Id</p>
                    </div>

                    <hr />

                    <dl class="row mb-0">
                        <dt class="col-sm-4">
                            <i class="fas fa-id-card text-primary"></i> PESEL
                        </dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-secondary">@Model.PESEL</span>
                        </dd>

                        <dt class="col-sm-4">
                            <i class="fas fa-envelope text-primary"></i> Email
                        </dt>
                        <dd class="col-sm-8">
                            <a href="mailto:@Model.Email">@Model.Email</a>
                        </dd>

                        <dt class="col-sm-4">
                            <i class="fas fa-phone text-primary"></i> Phone
                        </dt>
                        <dd class="col-sm-8">
                            <a href="tel:@Model.PhoneNumber">@Model.PhoneNumber</a>
                        </dd>

                        <dt class="col-sm-4">
                            <i class="fas fa-city text-primary"></i> City
                        </dt>
                        <dd class="col-sm-8">
                            @(Model.City ?? "N/A")
                        </dd>

                        <dt class="col-sm-4">
                            <i class="fas fa-map-marker-alt text-primary"></i> Postal Code
                        </dt>
                        <dd class="col-sm-8 mb-0">
                            @(Model.PostalCode ?? "N/A")
                        </dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Rental Statistics Card -->
        <div class="col-lg-8 mb-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i> Rental Statistics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="stat-box p-3 border rounded">
                                <h3 class="text-primary mb-1">@(Model.Rentals?.Count ?? 0)</h3>
                                <small class="text-muted">Total Rentals</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box p-3 border rounded">
                                <h3 class="text-success mb-1">@(Model.Rentals?.Count(r => r.Status == CarRentalSystem.Entities.Rentals.RentalStatus.Completed) ?? 0)</h3>
                                <small class="text-muted">Completed</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box p-3 border rounded">
                                <h3 class="text-warning mb-1">@(Model.Rentals?.Count(r => r.Status == CarRentalSystem.Entities.Rentals.RentalStatus.Active) ?? 0)</h3>
                                <small class="text-muted">Active</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box p-3 border rounded">
                                <h3 class="text-info mb-1">
                                    @(Model.Rentals?.SelectMany(r => r.Payments ?? Enumerable.Empty<CarRentalSystem.Entities.Rentals.Payment>())
                                        .Where(p => p.Status == CarRentalSystem.Entities.Rentals.PaymentStatus.Completed)
                                        .Sum(p => p.Amount).ToString("C") ?? "$0.00")
                                </h3>
                                <small class="text-muted">Total Spent</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rental History -->
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-history"></i> Rental History
                    </h5>
                </div>
                <div class="card-body p-0">
                    @if (Model.Rentals != null && Model.Rentals.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Rental ID</th>
                                        <th>Vehicle</th>
                                        <th>Rental Date</th>
                                        <th>Return Date</th>
                                        <th>Status</th>
                                        <th>Employee</th>
                                        <th>Total Paid</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var rental in Model.Rentals.OrderByDescending(r => r.RentalDate))
                                    {
                                        <tr>
                                            <td>
                                                <strong>#@rental.Id</strong>
                                            </td>
                                            <td>
                                                @if (rental.Car?.Model?.Brand != null)
                                                {
                                                    <span>
                                                        <i class="fas fa-car"></i>
                                                        @rental.Car.Model.Brand.BrandName @rental.Car.Model.ModelName
                                                        <br />
                                                        <small class="text-muted">@rental.Car.RegistrationNumber</small>
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">N/A</span>
                                                }
                                            </td>
                                            <td>@rental.RentalDate.ToString("MMM dd, yyyy")</td>
                                            <td>
                                                @if (rental.ReturnDate.HasValue)
                                                {
                                                    @rental.ReturnDate.Value.ToString("MMM dd, yyyy")
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Not returned</span>
                                                }
                                            </td>
                                            <td>
                                                @switch (rental.Status)
                                                {
                                                    case CarRentalSystem.Entities.Rentals.RentalStatus.Active:
                                                        <span class="badge bg-warning">Active</span>
                                                        break;
                                                    case CarRentalSystem.Entities.Rentals.RentalStatus.Completed:
                                                        <span class="badge bg-success">Completed</span>
                                                        break;
                                                    case CarRentalSystem.Entities.Rentals.RentalStatus.Reserved:
                                                        <span class="badge bg-info">Reserved</span>
                                                        break;
                                                    case CarRentalSystem.Entities.Rentals.RentalStatus.Cancelled:
                                                        <span class="badge bg-secondary">Cancelled</span>
                                                        break;
                                                    case CarRentalSystem.Entities.Rentals.RentalStatus.Overdue:
                                                        <span class="badge bg-danger">Overdue</span>
                                                        break;
                                                    default:
                                                        <span class="badge bg-secondary">@rental.Status</span>
                                                        break;
                                                }
                                            </td>
                                            <td>
                                                @if (rental.Employee != null)
                                                {
                                                    <span>@rental.Employee.FirstName @rental.Employee.LastName</span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">N/A</span>
                                                }
                                            </td>
                                            <td>
                                                <strong class="text-success">
                                                    @(rental.Payments?.Where(p => p.Status == CarRentalSystem.Entities.Rentals.PaymentStatus.Completed)
                                                        .Sum(p => p.Amount).ToString("C") ?? "$0.00")
                                                </strong>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-file-contract fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No Rental History</h5>
                            <p class="text-muted">This client has not made any rentals yet.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
